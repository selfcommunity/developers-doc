"use strict";(self.webpackChunkdevelopers_doc=self.webpackChunkdevelopers_doc||[]).push([[11584],{1151:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>R,contentTitle:()=>P,default:()=>D,frontMatter:()=>M,metadata:()=>s,toc:()=>v});const s=JSON.parse('{"id":"sdk/community-js/react-templates/Components/MainFeed","title":"Main Feed","description":"The Main Feed template renders the main feed page.","source":"@site/docs/sdk/community-js/react-templates/Components/MainFeed.mdx","sourceDirName":"sdk/community-js/react-templates/Components","slug":"/sdk/community-js/react-templates/Components/MainFeed","permalink":"/docs/sdk/community-js/react-templates/Components/MainFeed","draft":false,"unlisted":false,"editUrl":"https://github.com/selfcommunity/developers-doc/tree/main/docs/sdk/community-js/react-templates/Components/MainFeed.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Main Feed","sidebar_position":1,"title":"Main Feed"},"sidebar":"sdkSidebar","previous":{"title":"Loyalty Program Detail","permalink":"/docs/sdk/community-js/react-templates/Components/LoyaltyProgramDetail"},"next":{"title":"Notification Feed","permalink":"/docs/sdk/community-js/react-templates/Components/NotificationFeed"}}');var n=o(74848),i=o(28453),r=o(37180),a=o(96540),c=o(11848),d=o(47207),l=o(69907),u=o(25102),p=o(84202),m=o(85305),g=o(84497),h=o(26763),f=o(95754),y=o(93371),j=o(34108),A=o(29368),x=o(2877),S=o(44817),b=o(79197),_=o(13327),k=o.n(_),O=o(92922),C=o(18590),N=o(58065);const F="SCMainFeedTemplate",w={root:`${F}-root`},E=(0,c.Ay)(d.A,{name:F,slot:"Root"})((()=>({}))),T=[{type:"widget",component:l.A,componentProps:{},column:"right",position:0},{type:"widget",component:u.A,componentProps:{},column:"right",position:1},{type:"widget",component:p.A,componentProps:{},column:"right",position:2},{type:"widget",component:m.A,componentProps:{},column:"right",position:3}];const I=function(e){const t=(0,b.A)({props:e,name:F}),{id:o="main_feed",className:s,widgets:i=T,FeedObjectProps:r={},FeedSidebarProps:c=null,FeedProps:d={}}=t,l=(0,a.useContext)(x.T6),{enqueueSnackbar:u}=(0,C.dh)(),p=(0,a.useRef)();return l.user?(0,n.jsx)(E,Object.assign({id:o,className:k()(w.root,s),ref:p,endpoint:A.A.MainFeed,widgets:i,ItemComponent:g.A,itemPropsGenerator:(e,t)=>({feedObject:t[t.type],feedObjectType:t.type,feedObjectActivities:t.activities?t.activities:null,markRead:e?!t.seen_by_id.includes(e.id):null}),itemIdGenerator:e=>e[e.type].id,ItemProps:r,ItemSkeleton:h.A,ItemSkeletonProps:{template:f.a.PREVIEW},FeedSidebarProps:c,HeaderComponent:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(y.A,{onSuccess:e=>{u((0,n.jsx)(N.A,{id:"ui.inlineComposerWidget.success",defaultMessage:"ui.inlineComposerWidget.success"}),{variant:"success",autoHideDuration:3e3});const t={type:e.type,[e.type]:e,seen_by_id:[],has_boost:!1};p&&p.current&&p.current.addFeedData(t,!0)}}),S.qc(l.user)&&(0,n.jsx)(j.A,{onGeneratedContent:e=>{if(p&&p.current){const t=p.current.getCurrentFeedObjectIds();e.forEach((e=>{if(!t.includes(e.id)){const t={type:e.type,[e.type]:e,seen_by_id:[],has_boost:!1};p.current.addFeedData(t,!0)}}))}}})]}),requireAuthentication:!0,disablePaginationLinks:!0,enabledCustomAdvPositions:[O.Q.POSITION_FEED_SIDEBAR,O.Q.POSITION_FEED,O.Q.POSITION_BELOW_TOPBAR]},d)):null},M={sidebar_label:"Main Feed",sidebar_position:1,title:"Main Feed"},P=void 0,R={},v=[{value:"Usage",id:"usage",level:4}];function L(e){const t={blockquote:"blockquote",code:"code",h4:"h4",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"The Main Feed template renders the main feed page."}),"\n"]}),"\n","\n",(0,n.jsx)(r.A,{children:(0,n.jsx)(I,{})}),"\n",(0,n.jsx)(t.h4,{id:"usage",children:"Usage"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-jsx",children:" import React from 'react';\n import {SCContextProvider} from '@selfcommunity/react-core';\n import {MainFeed} from '@selfcommunity/react-templates';\n\n function App() {\n   const conf = {\n     portal: '<community-path>',\n     session: {\n       type: 'OAuth',\n       token: '<community-token>',\n       refreshToken: '<community-refresh-token>',\n       refreshTokenEndpoint: '<community-refresh-endpoint>',\n     },\n   };\n   return (\n     <SCContextProvider conf={conf}><MainFeed/></SCContextProvider>\n   );\n }\n"})})]})}function D(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(L,{...e})}):L(e)}},36175:(e,t,o)=>{o.d(t,{F:()=>s});const s={user:{username:"beatrice",password:"Password!!Beatrice2021",client_id:"XJjPE54IBBjhibs0Rf0wZ969cZNPq6WjC02FrkaM",grant_type:"password"},portal:"https://internal.selfcommunity.io/mkg2zxd0"}},37180:(e,t,o)=>{o.d(t,{A:()=>m});var s=o(96540),n=o(36175),i=o(75251);function r(e,t){void 0===e&&(e=""),void 0===t&&(t={});const o=Object.keys(t).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e]))).join("&");return fetch(e,{method:"POST",headers:{accept:"application/json","content-type":"application/x-www-form-urlencoded"},body:o})}function a(){if((0,i.A)()){const e={refresh_token:JSON.parse(window.localStorage.getItem("token")).refresh_token,client_id:n.F.user.client_id,grant_type:"refresh_token"};return r(`${n.F.portal}/oauth/token/`,e).then((e=>e.json())).then((e=>({accessToken:e.access_token,refreshToken:e.refresh_token,tokenType:e.token_type,expiresIn:e.expires_in}))).catch((e=>Promise.reject(e)))}}function c(){const e=(0,i.A)(),[t,o]=(0,s.useState)(e?JSON.parse(window.localStorage.getItem("token")):"");return(0,s.useEffect)((()=>{e&&(!t||1e3*t.expiresIn<Date.now()?r(`${n.F.portal}/oauth/token/`,n.F.user).then((e=>e.json())).then((e=>({accessToken:e.access_token,refreshToken:e.refresh_token,tokenType:e.token_type,expiresIn:e.expires_in}))).catch((e=>e)).then((e=>{o(e)})):e&&o(JSON.parse(window.localStorage.getItem("token"))))}),[e]),(0,s.useEffect)((()=>{e&&window.localStorage.setItem("token",JSON.stringify(t))}),[e,t]),t}var d=o(45284),l=o(28554),u=o(73906),p=o(74848);function m(e){let{children:t}=e;const o=c(),s={portal:n.F.portal,locale:{default:"en"},session:{type:"OAuth",clientId:n.F.user.client_id,authToken:o,handleRefreshToken:a},theme:l.Ay,handleAnonymousAction:()=>{alert("Anonymous action")}};return(0,p.jsx)(u.A,{children:()=>(0,p.jsx)(d.Ay,{conf:s,children:t})})}},84202:(e,t,o)=>{o.d(t,{A:()=>Q});var s=o(31635),n=o(74848),i=o(96540),r=o(11848),a=o(44675),c=o(90508),d=o(25292),l=o(47859),u=o(28820),p=o(36870),m=o(42942),g=o(27662),h=o(13550),f=o(29368),y=o(2877),j=o(86354),A=o(21810),x=o(54374),S=o(44806),b=o(58065),_=o(19546),k=o.n(_),O=o(86857),C=o(79197),N=o(9063),F=o(28692),w=o(94520),E=o(45949),T=o(29251),I=o(15906),M=o(43749),P=o(29440),R=o(23224),v=o.n(R),L=o(88454);const D={root:`${P.H}-root`,title:`${P.H}-title`,noResults:`${P.H}-no-results`,showMore:`${P.H}-show-more`,dialogRoot:`${P.H}-dialog-root`,endMessage:`${P.H}-end-message`},W=(0,r.Ay)(O.A,{name:P.H,slot:"Root"})((()=>({}))),H=(0,r.Ay)(T.A,{name:P.H,slot:"DialogRoot"})((()=>({})));const Q=function(e){const t=(0,C.A)({props:e,name:P.H}),{autoHide:o=!0,limit:r=3,className:_,CategoryProps:O={},cacheStrategy:T=F.So.NETWORK_ONLY,onHeightChange:R,onStateChange:Q,DialogProps:U={},categoryId:$}=t,X=(0,s.__rest)(t,["autoHide","limit","className","CategoryProps","cacheStrategy","onHeightChange","onStateChange","DialogProps","categoryId"]),q=(0,y.X1)(),[z,B]=(0,i.useReducer)(E.r6,{isLoadingNext:!1,next:null,cacheKey:j.j3(j.ss),cacheStrategy:T,visibleItems:r},E.Ox),[G,J]=(0,i.useState)(!1),K=(0,a.A)(),V=(0,c.A)(K.breakpoints.down("md")),Y=(0,i.useRef)(null),Z=(0,i.useMemo)((()=>()=>{z.initialized||z.isLoadingNext||(B({type:E.Qd.LOADING_NEXT}),g.h.getCategorySuggestion({limit:r}).then((e=>{B({type:E.Qd.LOAD_NEXT_SUCCESS,payload:Object.assign(Object.assign({},e),{initialized:!0})})})).catch((e=>{B({type:E.Qd.LOAD_NEXT_FAILURE,payload:{errorLoadNext:e}}),w.V.error(I.d,e)})))}),[z.isLoadingNext,z.initialized,r,B]),ee=(0,i.useCallback)(((e,t)=>{const o=[...z.results].map((e=>e.id===t.id?Object.assign(Object.assign({},e),t):e));B({type:E.Qd.SET_RESULTS,payload:{results:o}})}),[B,z.results]);(0,i.useEffect)((()=>(Y.current=v().subscribe(`${L.yt.CATEGORY}.${L.xq.EDIT}`,ee),()=>{Y.current&&v().unsubscribe(Y.current)})),[ee]),(0,i.useEffect)((()=>{let e;if(q.user)return e=setTimeout(Z),()=>{e&&clearTimeout(e)}}),[q.user]),(0,i.useEffect)((()=>{G&&z.next&&z.results.length<=r&&z.initialized&&(B({type:E.Qd.LOADING_NEXT}),g.h.getCategorySuggestion({offset:r,limit:10}).then((e=>{B({type:E.Qd.LOAD_NEXT_SUCCESS,payload:e})})).catch((e=>{B({type:E.Qd.LOAD_NEXT_FAILURE,payload:{errorLoadNext:e}}),w.V.error(I.d,e)})))}),[G,z.next,z.results.length,z.initialized,r]),(0,i.useEffect)((()=>{R&&R()}),[z.results]),(0,i.useEffect)((()=>{q.user&&T===F.So.NETWORK_ONLY&&Q&&Q({cacheStrategy:F.So.CACHE_FIRST})}),[q.user]);const te=(0,i.useMemo)((()=>e=>{const t=[...z.results],o=t.findIndex((t=>t.id===e.id));-1!==o&&(e.followed?(t[o].followers_counter=e.followers_counter-1,t[o].followed=!e.followed):(t[o].followers_counter=e.followers_counter+1,t[o].followed=!e.followed),B({type:E.Qd.SET_RESULTS,payload:{results:t}}))}),[B,z.count,z.results]),oe=(0,i.useMemo)((()=>()=>{B({type:E.Qd.LOADING_NEXT}),h.A.request({url:z.next,method:f.A.CategoriesSuggestion.method}).then((e=>{B({type:E.Qd.LOAD_NEXT_SUCCESS,payload:e.data})}))}),[B,z.next,z.isLoadingNext,z.initialized]),se=()=>{J((e=>!e))};if(o&&!z.count&&z.initialized||!q.user)return(0,n.jsx)(N.A,{});if(!z.initialized)return(0,n.jsx)(A.A,{});const ne=(0,n.jsxs)(d.A,{children:[(0,n.jsx)(l.A,Object.assign({className:D.title,variant:"h5"},{children:(0,n.jsx)(b.A,{id:"ui.categoriesSuggestionWidget.title",defaultMessage:"ui.categoriesSuggestionWidget.title"})})),z.count?(0,n.jsxs)(i.Fragment,{children:[(0,n.jsx)(u.A,{children:z.results.slice(0,z.visibleItems).map((e=>(0,n.jsx)(p.Ay,{children:(0,n.jsx)(x.A,Object.assign({elevation:0,category:e,categoryFollowButtonProps:{onFollow:te}},O))},e.id)))}),z.count>z.visibleItems&&(0,n.jsx)(m.A,Object.assign({className:D.showMore,onClick:se},{children:(0,n.jsx)(b.A,{id:"ui.categoriesSuggestionWidget.button.showAll",defaultMessage:"ui.categoriesSuggestionWidget.button.showAll"})}))]}):(0,n.jsx)(l.A,Object.assign({className:D.noResults,variant:"body2"},{children:(0,n.jsx)(b.A,{id:"ui.categoriesSuggestionWidget.noResults",defaultMessage:"ui.categoriesSuggestionWidget.noResults"})})),G&&(0,n.jsx)(H,Object.assign({className:D.dialogRoot,title:(0,n.jsx)(b.A,{defaultMessage:"ui.categoriesSuggestionWidget.title",id:"ui.categoriesSuggestionWidget.title"}),onClose:se,open:G},U,{children:(0,n.jsx)(M.A,Object.assign({dataLength:z.results.length,next:oe,hasMoreNext:Boolean(z.next),loaderNext:(0,n.jsx)(S.A,Object.assign({elevation:0},O)),height:V?"100%":400,endMessage:(0,n.jsx)(l.A,Object.assign({className:D.endMessage},{children:(0,n.jsx)(b.A,{id:"ui.categoriesSuggestionWidget.noMoreResults",defaultMessage:"ui.categoriesSuggestionWidget.noMoreResults"})}))},{children:(0,n.jsx)(u.A,{children:z.results.map((e=>(0,n.jsx)(p.Ay,{children:(0,n.jsx)(x.A,Object.assign({elevation:0,category:e},O,{categoryFollowButtonProps:{onFollow:te}}))},e.id)))})}))}))]});return(0,n.jsx)(W,Object.assign({className:k()(D.root,_)},X,{children:ne}))}}}]);